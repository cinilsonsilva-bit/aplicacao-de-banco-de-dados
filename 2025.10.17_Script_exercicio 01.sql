-- CONTEXTO: SISTEMA DE GESTÃO DE ESCRITÓRIO DE ADVOCACIA
 
-- NOME DA BASE DE DADOS: GESTAO_ADVOCACIA_2025
 
 
 
-- O OBJETIVO É RELACIONAR ADVOGADOS, CLIENTES, CASOS E AUDIENCIAS
-- E REALIZAR CONSULTAS USANDO DIFERENTES TIPOS DE JOIN
 
-- 1 USAR A BASE COM SEUS NOMES
 
 CREATE DATABASE _ABD_03361_A_NILSON_GESTAO_ADVOCACIA_2025;
 
 USE _ABD_03361_A_NILSON_GESTAO_ADVOCACIA_2025;
 
-- 2 CRIAR A TABELA ADVOGADOS
-- CAMPOS: id, nome, oab, especialidade
 
 CREATE TABLE ADVOGADOS (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL,
    OAB VARCHAR(20) NOT NULL,
    ESPECIALIDADE VARCHAR(100)
);

-- 3 CRIAR A TABELA CLIENTES
-- CAMPOS: id, nome, cpf, cidade
 
 CREATE TABLE CLIENTES (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL,
    CPF VARCHAR(14) NOT NULL,
    CIDADE VARCHAR(100)
);

-- 4 CRIAR A TABELA CASOS
-- CAMPOS: id, id_advogado, id_cliente, descricao, status, data_abertura
-- RELACIONAR id_advogado COM ADVOGADOS
-- RELACIONAR id_cliente COM CLIENTES
 
 CREATE TABLE CASOS (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    ID_ADVOGADO INT NOT NULL,
    ID_CLIENTE INT NOT NULL,
    DESCRICAO TEXT NOT NULL,
    STATUS_CASO VARCHAR(50),
    DATA_ABERTURA DATE NOT NULL,
    FOREIGN KEY (ID_ADVOGADO) REFERENCES ADVOGADOS(ID),
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTES(ID)
);

-- 5 CRIAR A TABELA AUDIENCIAS
-- CAMPOS: id, id_caso, data_audiencia, local, resultado
-- RELACIONAR id_caso COM CASOS
 
 CREATE TABLE AUDIENCIAS (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    ID_CASO INT NOT NULL,
    DATA_AUDIENCIA DATE NOT NULL,
    LOCAL VARCHAR(150) NOT NULL,
    RESULTADO VARCHAR(100),
    FOREIGN KEY (ID_CASO) REFERENCES CASOS(ID)
);

ALTER TABLE AUDIENCIAS
CHANGE LOCAL LOCAL_AUDIENCIA VARCHAR(150);

-- 6 POPULAR TODAS AS TABELAS COM PELO MENOS 5 REGISTROS
 
 INSERT INTO ADVOGADOS VALUES
(1, 'Mariana Alves', 'OAB-SP 12345', 'Direito Trabalhista'),
(2, 'Ricardo Gomes', 'OAB-SP 23456', 'Direito Civil'),
(3, 'Fernanda Costa', 'OAB-SP 34567', 'Direito Penal'),
(4, 'André Souza', 'OAB-SP 45678', 'Direito de Família'),
(5, 'Patrícia Lima', 'OAB-SP 56789', 'Direito Empresarial'),
(6, 'Roberto Ferreira', 'OAB-SP 67890', 'Direito Previdenciário'),
(7, 'Juliana Castro', 'OAB-SP 78901', 'Direito Imobiliário'),
(8, 'Carlos Mendes', 'OAB-SP 89012', 'Direito Tributário'),
(9, 'Luciana Rocha', 'OAB-SP 90123', 'Direito Ambiental'),
(10, 'Paulo Henrique', 'OAB-SP 01234', 'Direito do Consumidor');

INSERT INTO CLIENTES VALUES
(1, 'Ana Paula', '123.456.789-00', 'Santo André'),
(2, 'Bruno Silva', '234.567.890-11', 'São Bernardo do Campo'),
(3, 'Carla Oliveira', '345.678.901-22', 'São Caetano do Sul'),
(4, 'Daniel Souza', '456.789.012-33', 'Diadema'),
(5, 'Eduarda Lima', '567.890.123-44', 'Mauá'),
(6, 'Felipe Santos', '678.901.234-55', 'Santo André'),
(7, 'Gabriela Ramos', '789.012.345-66', 'São Bernardo do Campo'),
(8, 'Henrique Costa', '890.123.456-77', 'São Caetano do Sul'),
(9, 'Isabela Martins', '901.234.567-88', 'Diadema'),
(10, 'João Ferreira', '012.345.678-99', 'Mauá');

SHOW TABLES;

SELECT * FROM AUDIENCIAS;

INSERT INTO CASOS VALUES
(1, 1, 1, 'Ação trabalhista contra ex-empregador por horas extras.', 'Em andamento', '2024-01-15'),
(2, 2, 2, 'Processo de indenização por danos materiais.', 'Concluído', '2023-12-10'),
(3, 3, 3, 'Defesa em processo penal de lesão corporal.', 'Em andamento', '2024-03-22'),
(4, 4, 4, 'Divórcio litigioso com partilha de bens.', 'Em andamento', '2024-02-05'),
(5, 5, 5, 'Abertura de empresa e elaboração de contrato social.', 'Concluído', '2024-04-18'),
(6, 6, 6, 'Revisão de aposentadoria junto ao INSS.', 'Arquivado', '2023-11-25'),
(7, 7, 7, 'Regularização de imóvel em cartório.', 'Em andamento', '2024-05-10'),
(8, 8, 8, 'Ação tributária contra cobrança indevida de imposto.', 'Em andamento', '2024-06-01'),
(9, 9, 9, 'Licenciamento ambiental de empreendimento industrial.', 'Concluído', '2023-10-30'),
(10, 10, 10, 'Reclamação por propaganda enganosa de produto.', 'Em andamento', '2024-07-12');

SELECT * FROM CASOS;

INSERT INTO AUDIENCIAS VALUES
(1, 1, '2024-02-10', 'Fórum de Santo André', 'Audiência inicial concluída'),
(2, 2, '2023-12-20', 'Fórum de São Bernardo', 'Acordo entre as partes'),
(3, 3, '2024-04-15', 'Fórum de São Caetano', 'Remarcada'),
(4, 4, '2024-03-12', 'Fórum de Diadema', 'Em andamento'),
(5, 5, '2024-05-05', 'Fórum de Mauá', 'Sentença favorável ao cliente'),
(6, 6, '2023-12-02', 'Fórum de Santo André', 'Arquivado por desistência'),
(7, 7, '2024-06-20', 'Fórum de São Bernardo', 'Conclusão pendente'),
(8, 8, '2024-07-08', 'Fórum de São Caetano', 'Nova audiência marcada'),
(9, 9, '2023-11-10', 'Fórum de Diadema', 'Encerrado com acordo'),
(10, 10, '2024-08-01', 'Fórum de Mauá', 'Em análise final');


-- CONSULTAS (EXERCÍCIOS):
 
-- 7 INNER JOIN
-- MOSTRAR O NOME DO CLIENTE, O NOME DO ADVOGADO E A DESCRIÇÃO DO CASO
 
 SELECT 
    C.NOME AS NOME_CLIENTE,
    A.NOME AS NOME_ADVOGADO,
    CA.DESCRICAO AS DESCRICAO_CASO
FROM CASOS CA
INNER JOIN CLIENTES C ON CA.ID_CLIENTE = C.ID
INNER JOIN ADVOGADOS A ON CA.ID_ADVOGADO = A.ID;

-- 8 LEFT JOIN
-- MOSTRAR TODOS OS CLIENTES, MESMO OS QUE AINDA NÃO TÊM NENHUM CASO
 
 SELECT 
    C.NOME AS NOME_CLIENTE,
    A.NOME AS NOME_ADVOGADO,
    CA.DESCRICAO AS DESCRICAO_CASO
FROM CLIENTES C
LEFT JOIN CASOS CA ON CA.ID_CLIENTE = C.ID
LEFT JOIN ADVOGADOS A ON CA.ID_ADVOGADO = A.ID;

-- MOSTRAR TODOS OS ADVOGADOS, MESMO OS QUE AINDA NÃO TÊM NENHUM CASO 
 
 SELECT 
    A.NOME AS NOME_ADVOGADO,
    CA.DESCRICAO AS DESCRICAO_CASO
FROM ADVOGADOS A
LEFT JOIN CASOS CA ON CA.ID_ADVOGADO = A.ID;

-- 9 RIGHT JOIN
-- MOSTRAR TODOS OS CASOS, MESMO OS QUE AINDA NÃO POSSUEM CLIENTE DEFINIDO
 
 SELECT 
    C.NOME AS NOME_CLIENTE,
    CA.DESCRICAO AS DESCRICAO_CASO
FROM CLIENTES C
RIGHT JOIN CASOS CA ON CA.ID_CLIENTE = C.ID;

-- 10 FULL JOIN (USAR UNION)
-- MOSTRAR TODOS OS CLIENTES E CASOS, MESMO SEM RELAÇÃO ENTRE ELES
 
 -- LEFT JOIN: todos os clientes e seus casos (se existirem)
SELECT 
    C.NOME AS NOME_CLIENTE,
    A.NOME AS NOME_ADVOGADO,
    CA.DESCRICAO AS DESCRICAO_CASO
FROM CLIENTES C
LEFT JOIN CASOS CA ON CA.ID_CLIENTE = C.ID
LEFT JOIN ADVOGADOS A ON CA.ID_ADVOGADO = A.ID

UNION

-- RIGHT JOIN: todos os casos e seus clientes (se existirem), incluindo casos sem clientes
SELECT 
    C.NOME AS NOME_CLIENTE,
    A.NOME AS NOME_ADVOGADO,
    CA.DESCRICAO AS DESCRICAO_CASO
FROM CLIENTES C
RIGHT JOIN CASOS CA ON CA.ID_CLIENTE = C.ID
LEFT JOIN ADVOGADOS A ON CA.ID_ADVOGADO = A.ID;

-- 11 CROSS JOIN
-- GERAR UMA COMBINAÇÃO ENTRE TODOS OS ADVOGADOS E TODOS OS CLIENTES
-- (POSSÍVEIS RELAÇÕES DE ATENDIMENTO)
 
 SELECT 
    A.NOME AS NOME_ADVOGADO,
    C.NOME AS NOME_CLIENTE
FROM ADVOGADOS A
CROSS JOIN CLIENTES C;

-- 12 MOSTRAR OS CASOS QUE ESTÃO COM STATUS 'EM ANDAMENTO' E
-- QUE FORAM ABERTOS DEPOIS DE '2024-04-18'
-- USAR INNER JOIN E WHERE
 
 SELECT 
    C.NOME AS NOME_CLIENTE,
    A.NOME AS NOME_ADVOGADO,
    CA.DESCRICAO AS DESCRICAO_CASO,
    CA.STATUS_CASO,
    CA.DATA_ABERTURA
FROM CASOS CA
INNER JOIN CLIENTES C ON CA.ID_CLIENTE = C.ID
INNER JOIN ADVOGADOS A ON CA.ID_ADVOGADO = A.ID
WHERE CA.STATUS_CASO = 'EM ANDAMENTO'
  AND CA.DATA_ABERTURA > '2024-04-18';

-- 13 MOSTRAR CADA ADVOGADO E QUANTOS CASOS ELE POSSUI
-- USAR GROUP BY E COUNT
 
 SELECT 
    A.NOME AS NOME_ADVOGADO,
    COUNT(CA.ID) AS TOTAL_CASOS
FROM ADVOGADOS A
LEFT JOIN CASOS CA ON CA.ID_ADVOGADO = A.ID
GROUP BY A.ID, A.NOME;

-- 14 MOSTRAR OS CLIENTES ORDENADOS PELO NOME (A–Z)
-- E SUAS RESPECTIVAS CIDADES
 
 SELECT 
    NOME AS NOME_CLIENTE,
    CIDADE
FROM CLIENTES
ORDER BY NOME ASC;

 
-- 15 MOSTRAR O TOTAL DE AUDIENCIAS REALIZADAS EM UMA COLUNA CHAMADA TOTAL_AUDIENCIAS
-- USAR COUNT E AS
 
 SELECT 
    COUNT(*) AS TOTAL_AUDIENCIAS
FROM AUDIENCIAS;

-- 16 MOSTRAR OS CLIENTES DA CIDADE DE 'SÃO CAETANO DO SUL' E OS CASOS ASSOCIADOS
-- USAR INNER JOIN E WHERE
 
 SELECT 
    C.NOME AS NOME_CLIENTE,
    CA.DESCRICAO AS DESCRICAO_CASO
FROM CLIENTES C
INNER JOIN CASOS CA ON CA.ID_CLIENTE = C.ID
WHERE C.CIDADE = 'São Caetano do Sul';

-- 17 MOSTRAR OS ADVOGADOS QUE NÃO POSSUEM NENHUM CASO
-- USAR LEFT JOIN E IS NULL
 
 SELECT 
    A.NOME AS NOME_ADVOGADO
FROM ADVOGADOS A
LEFT JOIN CASOS CA ON CA.ID_ADVOGADO = A.ID
WHERE CA.ID IS NULL;

-- 18 MOSTRAR O NÚMERO TOTAL DE CASOS EM CADA STATUS (EX: 'EM ANDAMENTO', 'ENCERRADO')
-- USAR GROUP BY, COUNT E AS
 
 SELECT 
    STATUS_CASO AS STATUS,
    COUNT(*) AS TOTAL_CASOS
FROM CASOS
GROUP BY STATUS_CASO;

-- 19 MOSTRAR O ADVOGADO COM MAIS CASOS CADASTRADOS
-- DICA: USAR GROUP BY, ORDER BY E LIMIT 1
 
 SELECT 
    A.NOME AS NOME_ADVOGADO,
    COUNT(CA.ID) AS TOTAL_CASOS
FROM ADVOGADOS A
LEFT JOIN CASOS CA ON CA.ID_ADVOGADO = A.ID
GROUP BY A.ID, A.NOME
ORDER BY TOTAL_CASOS DESC
LIMIT 1;
